å®Œæ•´çš„ç©ºé—´è½¬å½•ç»„ï¼ˆSpatial Transcriptomics, STï¼‰åˆ†ææµç¨‹ï¼Œ
æ¶µç›–äº†ä»æ•°æ®å‡†å¤‡ã€è´¨æ§ã€æ ‡å‡†åŒ–ã€èšç±»åˆ†æã€ç©ºé—´å¯è§†åŒ–ã€å·®å¼‚è¡¨è¾¾åˆ†æåˆ°åŠŸèƒ½æ³¨é‡Šçš„è¯¦ç»†æ­¥éª¤å’Œ
å¯ç›´æ¥ä½¿ç”¨çš„ä»£ç ï¼ˆåŸºäº10X Genomics Visiumå¹³å°ï¼Œä½¿ç”¨Seuratã€SpatialExperimentå’Œggplot2ç­‰RåŒ…ï¼‰ã€‚

ä½œè€…ï¼šæŸ“å±±    æ›´æ–°æ—¥æœŸï¼š20250803

### âœ… ç©ºé—´è½¬å½•ç»„åˆ†æå…·ä½“æ­¥éª¤ï¼ˆåŸºäº10X Visium + Seuratï¼‰

ä¸€ã€ç¯å¢ƒå‡†å¤‡

    å®‰è£…å¹¶åŠ è½½ Seuratã€ggplot2ã€patchworkã€dplyr ç­‰RåŒ…ã€‚

äºŒã€è¯»å–ç©ºé—´è½¬å½•ç»„æ•°æ®

    ä½¿ç”¨ Load10X_Spatial() å‡½æ•°è¯»å– Visium æ•°æ®æ–‡ä»¶å¤¹ï¼ˆåŒ…å«è¡¨è¾¾çŸ©é˜µå’Œç»„ç»‡å›¾åƒï¼‰ã€‚

ä¸‰ã€è´¨æ§ï¼ˆQCï¼‰

    è®¡ç®—æ¯ä¸ªspotçš„çº¿ç²’ä½“æ¯”ä¾‹ï¼ˆPercentageFeatureSetï¼‰ã€‚

    è¿‡æ»¤ä½è´¨é‡spotï¼ˆå¦‚åŸºå› æ•°è¿‡å°‘æˆ–è¿‡å¤šã€çº¿ç²’ä½“æ¯”ä¾‹é«˜ï¼‰ã€‚

    å¯è§†åŒ– QC æŒ‡æ ‡ï¼ˆå¦‚nFeature_RNA, percent.mtï¼‰ã€‚

å››ã€æ ‡å‡†åŒ–ä¸é«˜å˜åŸºå› é€‰æ‹©

    ä½¿ç”¨ SCTransform è¿›è¡Œå½’ä¸€åŒ–å’Œé«˜å˜åŸºå› è¯†åˆ«ã€‚

äº”ã€é™ç»´ä¸èšç±»åˆ†æ

    è¿è¡Œ PCA é™ç»´ (RunPCA)ã€‚

    æ„å»ºé‚»æ¥å›¾å¹¶è¿›è¡Œèšç±» (FindNeighbors + FindClusters)ã€‚

    è¿è¡Œ UMAP è¿›è¡Œå¯è§†åŒ– (RunUMAP)ã€‚

å…­ã€ç©ºé—´å¯è§†åŒ–

    ä½¿ç”¨ SpatialDimPlot å±•ç¤ºç»„ç»‡ç»“æ„å’Œèšç±»ç»“æœã€‚

    ä½¿ç”¨ SpatialFeaturePlot å¯è§†åŒ–åŸºå› åœ¨ç©ºé—´ç»„ç»‡ä¸­çš„è¡¨è¾¾ã€‚

ä¸ƒã€å·®å¼‚è¡¨è¾¾åˆ†æ

    ä½¿ç”¨ FindAllMarkers æŸ¥æ‰¾ä¸åŒç©ºé—´èšç±»çš„æ ‡å¿—åŸºå› ã€‚

    è¾“å‡ºæ¯ä¸ªèšç±»ä¸­ä¸Šè°ƒçš„å…³é”®åŸºå› ã€‚

å…«ã€GO/KEGG åŠŸèƒ½å¯Œé›†åˆ†æï¼ˆå¯é€‰ï¼‰

    å°†å·®å¼‚åŸºå› è½¬æ¢ä¸ºENTREZ IDï¼ˆä½¿ç”¨ bitrï¼‰ã€‚

    ä½¿ç”¨ enrichGO() è¿›è¡ŒåŠŸèƒ½æ³¨é‡Šåˆ†æã€‚

    ä½¿ç”¨ barplot() æˆ– dotplot() å±•ç¤ºç»“æœã€‚

ä¹ã€ç©ºé—´ç»“æ„è¯†åˆ«ï¼ˆå¯é€‰é«˜çº§ï¼‰

    è¿›ä¸€æ­¥ä½¿ç”¨ BayesSpaceã€SpatialDE æˆ– Giotto ç­‰å·¥å…·è¯†åˆ«ç©ºé—´åŸŸã€‚

åã€ä¿å­˜åˆ†æç»“æœ

    ä½¿ç”¨ saveRDS() ä¿å­˜ Seurat å¯¹è±¡ã€‚

    ä½¿ç”¨ write.csv() å¯¼å‡ºå·®å¼‚è¡¨è¾¾åŸºå› è¡¨æ ¼ã€‚

---

## ğŸ§¬ 0 ç¯å¢ƒå‡†å¤‡

```r
# å®‰è£…å¿…è¦RåŒ…ï¼ˆå¦‚æœªå®‰è£…ï¼‰
if (!require("Seurat")) install.packages("Seurat")
if (!require("SeuratData")) install.packages("SeuratData")
if (!require("patchwork")) install.packages("patchwork")
if (!require("ggplot2")) install.packages("ggplot2")
if (!require("dplyr")) install.packages("dplyr")

# åŠ è½½
library(Seurat)
library(SeuratData)
library(patchwork)
library(ggplot2)
library(dplyr)
```

## ğŸ“‚ 1 è¯»å–ç©ºé—´è½¬å½•ç»„æ•°æ®

æ•°æ®ç›®å½•åŒ…å«ï¼š

    filtered_feature_bc_matrix/

    spatial/ æ–‡ä»¶å¤¹ï¼ˆå«å›¾åƒå’Œå®šä½ä¿¡æ¯ï¼‰

```r
# æ›¿æ¢ä¸ºä½ çš„æ•°æ®ç›®å½•
data_dir <- "/path/to/your/spatial/data"

# åˆ›å»ºSeuratå¯¹è±¡
st_data <- Load10X_Spatial(data.dir = data_dir)

# æŸ¥çœ‹å¯¹è±¡åŸºæœ¬ä¿¡æ¯
st_data
```

## ğŸ” 2 è´¨æ§ï¼ˆQCï¼‰

```r
# è®¡ç®—çº¿ç²’ä½“æ¯”ä¾‹
st_data[["percent.mt"]] <- PercentageFeatureSet(st_data, pattern = "^MT-")

# å¯è§†åŒ–QCæŒ‡æ ‡
VlnPlot(st_data, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), pt.size = 0.1)

# ç­›é€‰ä½è´¨é‡ç‚¹
st_data <- subset(st_data, subset = nFeature_RNA > 200 & nFeature_RNA < 7500 & percent.mt < 5)
```

## ğŸ§ª 3 æ ‡å‡†åŒ– & é«˜å˜åŸºå› ç­›é€‰

```r
st_data <- SCTransform(st_data, assay = "Spatial", verbose = FALSE)
```

## ğŸ§¬ 4 é™ç»´ã€èšç±»ã€UMAP

```r
st_data <- RunPCA(st_data, assay = "SCT", verbose = FALSE)
st_data <- FindNeighbors(st_data, reduction = "pca", dims = 1:30)
st_data <- FindClusters(st_data, resolution = 0.5)
st_data <- RunUMAP(st_data, reduction = "pca", dims = 1:30)
```

## ğŸ—ºï¸5 ç©ºé—´å¯è§†åŒ–

```r
# ç©ºé—´ç‚¹å›¾
SpatialDimPlot(st_data, label = TRUE, label.size = 3)

# æŸåŸºå› åœ¨ç»„ç»‡ä¸­çš„è¡¨è¾¾åˆ†å¸ƒ
SpatialFeaturePlot(st_data, features = c("Snap25", "Mbp", "Gad1"))
```

### ğŸ§¬ 6 å·®å¼‚è¡¨è¾¾åˆ†æ

```r
# è·å–æ‰€æœ‰clusteré—´å·®å¼‚è¡¨è¾¾åŸºå› 
cluster_markers <- FindAllMarkers(st_data, only.pos = TRUE, min.pct = 0.25, logfc.threshold = 0.25)

# æŸ¥çœ‹top marker
cluster_markers %>% group_by(cluster) %>% top_n(n = 5, wt = avg_log2FC)
```

## ğŸ§  7 GO/KEGG å¯Œé›†åˆ†æï¼ˆå¯é€‰ï¼‰

```r
# ä½¿ç”¨clusterProfileråŒ…è¿›è¡Œå¯Œé›†åˆ†æï¼š

if (!require("clusterProfiler")) install.packages("clusterProfiler")
library(clusterProfiler)
library(org.Hs.eg.db)

# å‡è®¾æˆ‘ä»¬åˆ†æç¬¬ä¸€ä¸ªcluster
genes <- cluster_markers %>% filter(cluster == 0) %>% pull(gene)

# è½¬æ¢ä¸ºENTREZID
entrez_genes <- bitr(genes, fromType="SYMBOL", toType="ENTREZID", OrgDb=org.Hs.eg.db)

# GOåˆ†æ
go_result <- enrichGO(gene = entrez_genes$ENTREZID, OrgDb = org.Hs.eg.db, ont = "BP", readable = TRUE)

# å¯è§†åŒ–
barplot(go_result, showCategory = 10)
```

## ğŸŒ 8 ç©ºé—´åŸŸè¯†åˆ«ï¼ˆSpace Ranger æˆ– SpatialDEï¼‰

è‹¥æœ‰ç‰©ç†ç»„ç»‡ä½ç½®ä¿¡æ¯å’Œspotåæ ‡ï¼Œå¯ä½¿ç”¨BayesSpaceã€Giottoç­‰å·¥å…·è¿›è¡Œç©ºé—´åŸŸå»ºæ¨¡ã€‚
è‹¥éœ€ï¼Œæˆ‘å¯ç»§ç»­ç»™å‡ºè¿™äº›é«˜çº§æ–¹æ³•ã€‚

## ğŸ“Œ 9 ä¿å­˜ç»“æœ

```r
# ä¿å­˜Seuratå¯¹è±¡
saveRDS(st_data, file = "your_sample_spatial_seurat.rds")

# å¯¼å‡ºå·®å¼‚è¡¨è¾¾åŸºå› 
write.csv(cluster_markers, "cluster_markers.csv", row.names = FALSE)
```

## ğŸ—ƒï¸ é™„å½•ï¼šå¸¸è§æ•°æ®èµ„æº

    10x Genomics ç¤ºä¾‹æ•°æ®

    Human Protein Atlas

    SpatialDE
